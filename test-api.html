<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>–¢–µ—Å—Ç API –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				max-width: 800px;
				margin: 0 auto;
				padding: 20px;
				background-color: #f5f5f5;
			}
			.container {
				background: white;
				padding: 20px;
				border-radius: 8px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
				margin-bottom: 20px;
			}
			.form-group {
				margin-bottom: 15px;
			}
			label {
				display: block;
				margin-bottom: 5px;
				font-weight: bold;
			}
			input,
			textarea {
				width: 100%;
				padding: 8px;
				border: 1px solid #ddd;
				border-radius: 4px;
				box-sizing: border-box;
			}
			button {
				background-color: #007bff;
				color: white;
				padding: 10px 20px;
				border: none;
				border-radius: 4px;
				cursor: pointer;
				margin-right: 10px;
			}
			button:hover {
				background-color: #0056b3;
			}
			.result {
				background-color: #f8f9fa;
				border: 1px solid #dee2e6;
				border-radius: 4px;
				padding: 15px;
				margin-top: 15px;
				white-space: pre-wrap;
				font-family: monospace;
			}
			.success {
				background-color: #d4edda;
				border-color: #c3e6cb;
				color: #155724;
			}
			.error {
				background-color: #f8d7da;
				border-color: #f5c6cb;
				color: #721c24;
			}
		</style>
	</head>
	<body>
		<h1>üß™ –¢–µ—Å—Ç API –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</h1>

		<!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
		<div class="container">
			<h2>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
			<div class="form-group">
				<label for="regEmail">Email:</label>
				<input type="email" id="regEmail" value="test@example.com" />
			</div>
			<div class="form-group">
				<label for="regPassword">–ü–∞—Ä–æ–ª—å:</label>
				<input type="password" id="regPassword" value="123456" />
			</div>
			<div class="form-group">
				<label for="regFirstName">–ò–º—è:</label>
				<input type="text" id="regFirstName" value="–ò–≤–∞–Ω" />
			</div>
			<div class="form-group">
				<label for="regLastName">–§–∞–º–∏–ª–∏—è:</label>
				<input type="text" id="regLastName" value="–ò–≤–∞–Ω–æ–≤" />
			</div>
			<button onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
			<div id="registerResult" class="result"></div>
		</div>

		<!-- –í—Ö–æ–¥ -->
		<div class="container">
			<h2>üîë –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
			<div class="form-group">
				<label for="loginEmail">Email:</label>
				<input type="email" id="loginEmail" value="test@example.com" />
			</div>
			<div class="form-group">
				<label for="loginPassword">–ü–∞—Ä–æ–ª—å:</label>
				<input type="password" id="loginPassword" value="123456" />
			</div>
			<button onclick="login()">–í–æ–π—Ç–∏</button>
			<div id="loginResult" class="result"></div>
		</div>

		<!-- –ó–∞—â–∏—â–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç -->
		<div class="container">
			<h2>üîí –ó–∞—â–∏—â–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç</h2>
			<button onclick="getProfile()">–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
			<div id="profileResult" class="result"></div>
		</div>

		<script>
			let authToken = "";

			async function register() {
				const email = document.getElementById("regEmail").value;
				const password = document.getElementById("regPassword").value;
				const firstName = document.getElementById("regFirstName").value;
				const lastName = document.getElementById("regLastName").value;

				try {
					const response = await fetch("http://localhost:3001/auth/register", {
						method: "POST",
						headers: {
							"Content-Type": "application/json",
						},
						body: JSON.stringify({
							email,
							password,
							firstName,
							lastName,
						}),
					});

					const result = await response.json();

					if (response.ok) {
						authToken = result.accessToken;
						document.getElementById("registerResult").innerHTML =
							"‚úÖ –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è!\n\n" + JSON.stringify(result, null, 2);
						document.getElementById("registerResult").className = "result success";
					} else {
						document.getElementById("registerResult").innerHTML =
							"‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:\n\n" + JSON.stringify(result, null, 2);
						document.getElementById("registerResult").className = "result error";
					}
				} catch (error) {
					document.getElementById("registerResult").innerHTML =
						"‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:\n\n" + error.message;
					document.getElementById("registerResult").className = "result error";
				}
			}

			async function login() {
				const email = document.getElementById("loginEmail").value;
				const password = document.getElementById("loginPassword").value;

				try {
					const response = await fetch("http://localhost:3001/auth/login", {
						method: "POST",
						headers: {
							"Content-Type": "application/json",
						},
						body: JSON.stringify({
							email,
							password,
						}),
					});

					const result = await response.json();

					if (response.ok) {
						authToken = result.accessToken;
						document.getElementById("loginResult").innerHTML =
							"‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!\n\n" + JSON.stringify(result, null, 2);
						document.getElementById("loginResult").className = "result success";
					} else {
						document.getElementById("loginResult").innerHTML =
							"‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:\n\n" + JSON.stringify(result, null, 2);
						document.getElementById("loginResult").className = "result error";
					}
				} catch (error) {
					document.getElementById("loginResult").innerHTML = "‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:\n\n" + error.message;
					document.getElementById("loginResult").className = "result error";
				}
			}

			async function getProfile() {
				if (!authToken) {
					document.getElementById("profileResult").innerHTML = "‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!";
					document.getElementById("profileResult").className = "result error";
					return;
				}

				try {
					const response = await fetch("http://localhost:3001/protected/profile", {
						method: "GET",
						headers: {
							Authorization: `Bearer ${authToken}`,
						},
					});

					const result = await response.json();

					if (response.ok) {
						document.getElementById("profileResult").innerHTML =
							"‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—É—á–µ–Ω!\n\n" + JSON.stringify(result, null, 2);
						document.getElementById("profileResult").className = "result success";
					} else {
						document.getElementById("profileResult").innerHTML =
							"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:\n\n" + JSON.stringify(result, null, 2);
						document.getElementById("profileResult").className = "result error";
					}
				} catch (error) {
					document.getElementById("profileResult").innerHTML =
						"‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:\n\n" + error.message;
					document.getElementById("profileResult").className = "result error";
				}
			}
		</script>
	</body>
</html>
