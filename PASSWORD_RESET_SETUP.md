# Настройка сброса пароля через Firebase

## Описание

Реализован новый алгоритм сброса пароля через Firebase. Пользователь нажимает кнопку "Send reset email" в настройках профиля, и система отправляет письмо с инструкциями по сбросу пароля на email пользователя.

## Что изменилось

### Backend изменения:

1. **FirebaseService** - добавлен метод `sendPasswordResetEmail()` для отправки писем через Firebase Auth REST API
2. **AuthController** - добавлен эндпоинт `POST /auth/send-password-reset`
3. **AuthService** - добавлен метод `sendPasswordReset()` с проверкой пользователя
4. **DTO** - добавлен `SendPasswordResetDto` для валидации

### Frontend изменения:

1. **API Route** - создан `/api/auth/send-password-reset/route.ts`
2. **AuthService** - добавлен метод `sendPasswordReset()`
3. **AuthContext** - добавлен метод `sendPasswordReset()`
4. **ProfileContent** - заменена старая форма смены пароля на кнопку отправки письма
5. **Toast система** - добавлены компоненты для уведомлений
6. **Types** - добавлены типы для нового функционала

## Настройка окружения

### Backend (.env)

Добавьте следующую переменную окружения:

```env
FIREBASE_WEB_API_KEY=your_firebase_web_api_key_here
```

### Как получить Firebase Web API Key:

1. Откройте [Firebase Console](https://console.firebase.google.com/)
2. Выберите ваш проект
3. Перейдите в **Project Settings** (шестеренка)
4. Во вкладке **General** найдите **Web API Key**
5. Скопируйте ключ и добавьте в `.env` файл

## Алгоритм работы

1. **Пользователь** нажимает кнопку "Send reset email" в настройках профиля
2. **Frontend** отправляет POST запрос на `/api/auth/send-password-reset` с email пользователя
3. **API Route** перенаправляет запрос на бэкенд `/auth/send-password-reset`
4. **Backend** проверяет существование пользователя в PostgreSQL
5. **Backend** проверяет, что у пользователя есть пароль (не Google-пользователь)
6. **Backend** отправляет запрос в Firebase Auth REST API для отправки письма сброса пароля
7. **Firebase** отправляет письмо пользователю с ссылкой для сброса пароля
8. **Frontend** показывает Toast уведомление об успешной отправке письма

## Безопасность

- Для безопасности, независимо от результата, пользователю всегда показывается одинаковое сообщение
- Google-пользователи не могут сбросить пароль (у них нет пароля)
- Валидация email на стороне бэкенда
- Обработка ошибок без раскрытия деталей

## Тестирование

1. Зайдите в настройки профиля
2. Нажмите кнопку "Send reset email"
3. Проверьте, что появилось Toast уведомление
4. Проверьте почту - должно прийти письмо от Firebase
5. Перейдите по ссылке в письме и смените пароль

## Возможные проблемы

1. **"FIREBASE_WEB_API_KEY not found"** - проверьте переменную окружения
2. **"Failed to send password reset email"** - проверьте подключение к Firebase
3. **Toast не появляется** - проверьте, что ToastProvider обернут вокруг приложения
