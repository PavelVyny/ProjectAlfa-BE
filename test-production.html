<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>–¢–µ—Å—Ç –ø—Ä–æ–¥–∞–∫—à–Ω API - Project Alfa</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				max-width: 800px;
				margin: 0 auto;
				padding: 20px;
				background-color: #f5f5f5;
			}
			.container {
				background: white;
				padding: 30px;
				border-radius: 10px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			}
			h1 {
				color: #333;
				text-align: center;
				margin-bottom: 30px;
			}
			.form-group {
				margin-bottom: 20px;
			}
			label {
				display: block;
				margin-bottom: 5px;
				font-weight: bold;
				color: #555;
			}
			input[type="text"],
			input[type="email"],
			input[type="password"] {
				width: 100%;
				padding: 12px;
				border: 1px solid #ddd;
				border-radius: 5px;
				font-size: 16px;
				box-sizing: border-box;
			}
			button {
				background-color: #007bff;
				color: white;
				padding: 12px 24px;
				border: none;
				border-radius: 5px;
				cursor: pointer;
				font-size: 16px;
				margin-right: 10px;
				margin-bottom: 10px;
			}
			button:hover {
				background-color: #0056b3;
			}
			.result {
				margin-top: 20px;
				padding: 15px;
				border-radius: 5px;
				white-space: pre-wrap;
				font-family: monospace;
				font-size: 14px;
			}
			.success {
				background-color: #d4edda;
				border: 1px solid #c3e6cb;
				color: #155724;
			}
			.error {
				background-color: #f8d7da;
				border: 1px solid #f5c6cb;
				color: #721c24;
			}
			.info {
				background-color: #d1ecf1;
				border: 1px solid #bee5eb;
				color: #0c5460;
			}
			.server-info {
				background-color: #e2e3e5;
				border: 1px solid #d6d8db;
				color: #383d41;
				padding: 10px;
				border-radius: 5px;
				margin-bottom: 20px;
				text-align: center;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>üöÄ –¢–µ—Å—Ç –ø—Ä–æ–¥–∞–∫—à–Ω API - Project Alfa</h1>

			<div class="server-info">
				<strong>üåê –°–µ—Ä–≤–µ—Ä:</strong> https://project-alfa-backend-480977786594.us-central1.run.app
			</div>

			<h2>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
			<form id="registerForm">
				<div class="form-group">
					<label for="email">Email:</label>
					<input type="email" id="email" value="test-cloud@example.com" required />
				</div>
				<div class="form-group">
					<label for="password">–ü–∞—Ä–æ–ª—å:</label>
					<input type="password" id="password" value="123456" required />
				</div>
				<div class="form-group">
					<label for="firstName">–ò–º—è:</label>
					<input type="text" id="firstName" value="Cloud" required />
				</div>
				<div class="form-group">
					<label for="lastName">–§–∞–º–∏–ª–∏—è:</label>
					<input type="text" id="lastName" value="User" required />
				</div>
				<button type="submit">üöÄ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
			</form>

			<h2>üîê –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
			<form id="loginForm">
				<div class="form-group">
					<label for="loginEmail">Email:</label>
					<input type="email" id="loginEmail" value="test-cloud@example.com" required />
				</div>
				<div class="form-group">
					<label for="loginPassword">–ü–∞—Ä–æ–ª—å:</label>
					<input type="password" id="loginPassword" value="123456" required />
				</div>
				<button type="submit">üîë –í–æ–π—Ç–∏</button>
			</form>

			<h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å (–∑–∞—â–∏—â–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç)</h2>
			<button onclick="getProfile()">üë§ –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>

			<div id="result"></div>
		</div>

		<script>
			let currentToken = "";

			// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
			document.getElementById("registerForm").addEventListener("submit", async (e) => {
				e.preventDefault();
				const data = {
					email: document.getElementById("email").value,
					password: document.getElementById("password").value,
					firstName: document.getElementById("firstName").value,
					lastName: document.getElementById("lastName").value,
				};

				try {
					const response = await fetch(
						"https://project-alfa-backend-480977786594.us-central1.run.app/auth/register",
						{
							method: "POST",
							headers: {
								"Content-Type": "application/json",
							},
							body: JSON.stringify(data),
						},
					);

					const result = await response.json();

					if (response.ok) {
						currentToken = result.accessToken;
						showResult("‚úÖ –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è!", result, "success");
					} else {
						showResult("‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:", result, "error");
					}
				} catch (error) {
					showResult("‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:", error.message, "error");
				}
			});

			// –í—Ö–æ–¥
			document.getElementById("loginForm").addEventListener("submit", async (e) => {
				e.preventDefault();
				const data = {
					email: document.getElementById("loginEmail").value,
					password: document.getElementById("loginPassword").value,
				};

				try {
					const response = await fetch(
						"https://project-alfa-backend-480977786594.us-central1.run.app/auth/login",
						{
							method: "POST",
							headers: {
								"Content-Type": "application/json",
							},
							body: JSON.stringify(data),
						},
					);

					const result = await response.json();

					if (response.ok) {
						currentToken = result.accessToken;
						showResult("‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!", result, "success");
					} else {
						showResult("‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:", result, "error");
					}
				} catch (error) {
					showResult("‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:", error.message, "error");
				}
			});

			// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
			async function getProfile() {
				if (!currentToken) {
					showResult("‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!", "", "error");
					return;
				}

				try {
					const response = await fetch(
						"https://project-alfa-backend-480977786594.us-central1.run.app/protected/profile",
						{
							headers: {
								Authorization: `Bearer ${currentToken}`,
							},
						},
					);

					const result = await response.json();

					if (response.ok) {
						showResult("‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—É—á–µ–Ω!", result, "success");
					} else {
						showResult("‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:", result, "error");
					}
				} catch (error) {
					showResult("‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:", error.message, "error");
				}
			}

			function showResult(title, data, type) {
				const resultDiv = document.getElementById("result");
				const content = `${title}\n\n${JSON.stringify(data, null, 2)}`;
				resultDiv.textContent = content;
				resultDiv.className = `result ${type}`;
			}
		</script>
	</body>
</html>
